<link rel="import" href="../my-album/my-album.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="../paper-audio-player/paper-audio-player.html">


<dom-module is="hindi-album">
    <style is="custom-style">
    
        paper-audio-player.orange {
            --paper-audio-player-color: #F05C38;
        }
        
        paper-audio-player.blue {
            --paper-audio-player-color: #90D9D6;
        }
        
        paper-audio-player.broken {
            --paper-audio-player-color: #43BBF9;
        }
        
        #footer {
            position: fixed;
            left: 0px;
            bottom: 0px;
            height: 50px;
            margin: 10px 0;
            padding-left: 10px;
            width: 98.7%
        }
        paper-progress.red {
            width: 100%;
            position: fixed;
            left: 0;
            top: 0;
            height: 10px;
            z-index : 10000;
            --paper-progress-active-color: #F05C38;
        }
    
    </style>
    
    <template>
        <paper-progress class="red" indeterminate disabled="{{!isLoading}}"></paper-progress>
        <iron-ajax on-response="handleData"
            handle-as="json">
        </iron-ajax>

        <iron-scroll-threshold on-lower-threshold="loadMoreData">
            <template is="dom-repeat" items="{{data}}">
                <my-album item="{{item}}" is-loading="{{isLoading}}" selected-song="{{selectedSong}}"></my-album>
            </template>
        </iron-scroll-threshold>
        
        <paper-audio-player id="footer" auto-play="true" color="#F05C38"></paper-audio-player>
    </template>
</dom-module>
<script>
Polymer({
    is: "hindi-album",
    properties: {
        data: {
            type: String,
            observer : '_toggleIsLoading'
        },
        selectedSong : {
            type : Object,
            observer : 'songChnaged'
        },
        counter : {
            type : int,
            value : 0
        },
        isLoading : {
            type : Boolean,
            value : true,
            observer : "_setLoading"
        },

    },

    listeners: {
        'stop-loading' : '_stopLoading' 
    },

    ready : function(){
        this.loadMoreData();
    },

    _stopLoading : function(event){
        this.isLoading = false;
    },

    _toggleIsLoading : function(data){
        if (data){
            this.isLoading = false;
        }
    },

    _setLoading : function(data){
        this.isLoading = data;
    },

    loadMoreData : function(){
        this.counter = this.counter + 1;
        this.$.getSongs.url = '/album/' + this.counter + '/' ;
        this.$.getSongs.generateRequest();
    },

    handleData : function(data){
        this.data.push(data);
    },

    songChnaged: function(
        data) {

        this.isLoading = true;
        this.$['footer'].src= data.fields.song_url;
        this.$['footer'].title = data.fields.song_name;
        var that = this;
        
    }

});
</script>
