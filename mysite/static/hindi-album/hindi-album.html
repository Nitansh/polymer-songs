<link rel="import" href="../my-album/my-album.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-audio-player/paper-audio-player.html">


<dom-module is="hindi-album">
    <style is="custom-style">
    
        paper-audio-player.orange {
            --paper-audio-player-color: #F05C38;
        }
        
        paper-audio-player.blue {
            --paper-audio-player-color: #90D9D6;
        }
        
        paper-audio-player.broken {
            --paper-audio-player-color: #43BBF9;
        }
        
        #footer {
            position: fixed;
            left: 0px;
            bottom: 0px;
            height: 50px;
            margin: 10px 0;
            padding-left: 10px;
            width: 98.7%
        }
        paper-progress.red {
            width: 100%;
            position: fixed;
            left: 0;
            top: 0;
            height: 10px;
            z-index : 10000;
            --paper-progress-active-color: #F05C38;
        }
    
    </style>
    
    <template>
        <paper-progress class="red" indeterminate disabled="{{!isLoading}}"></paper-progress>
        <iron-ajax auto url="/album/" last-response="{{data}}"
            handle-as="json">
        </iron-ajax>
        
        <template is="dom-repeat" items="{{data}}">
            <my-album item="{{item}}" is-loading="{{isLoading}}" selected-song="{{selectedSong}}"></my-album>
        </template>
        <paper-audio-player id="footer" auto-play="true" color="#F05C38"></paper-audio-player>
    </template>
</dom-module>
<script>
Polymer({
    is: "hindi-album",
    properties: {
        data: {
            type: String,
            observer : '_toggleIsLoading'
        },
        selectedSong : {
            type : Object,
            observer : 'songChnaged'
        },
        isLoading : {
            type : Boolean,
            value : true,
            observer : "_setLoading"
        }

    },
    _toggleIsLoading : function(data){
        if (data){
            this.isLoading = false;
        }
    },

    _setLoading : function(data){
        this.isLoading = data;
    },

    songChnaged: function(
        data) {

        this.isLoading = true;
        this.$['footer'].src= data.fields.song_url;
        this.$['footer'].title = data.fields.song_name;
        var that = this;
        
        setTimeout(function(){
            that.isLoading = false;
        },10000);

    }

});
</script>
